# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï: Zustand –±–µ–∑ persist

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

Zustand —Å `persist` middleware **–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ** —Å–¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Å SSR –≤ Next.js –±–µ–∑ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –∫–æ—Å—Ç—ã–ª–µ–π. –î–∞–∂–µ —É—Å–ª–æ–≤–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–º–ø–æ—Ä—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

**–£–ë–†–ê–õ–ò persist middleware –ü–û–õ–ù–û–°–¢–¨–Æ** –∏–∑ Zustand store.

### –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ:

```typescript
// ‚ùå –°–¢–ê–†–´–ô –ö–û–î (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª)
import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';

export const useUserStore = create(
  persist(
    (set, get) => ({ ... }),
    { name: 'storage', storage: ... }
  )
);
```

```typescript
// ‚úÖ –ù–û–í–´–ô –ö–û–î (—Ä–∞–±–æ—Ç–∞–µ—Ç)
import { create } from 'zustand';

export const useUserStore = create<UserState>((set, get) => ({
  user: null,
  userProgress: [],
  isAuthenticated: false,
  
  setUser: (user) => set({ user, isAuthenticated: !!user }),
  logout: () => set({ user: null, isAuthenticated: false }),
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
}));
```

## üìù –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?

### ‚úÖ –ü–ª—é—Å—ã:
- **100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å SSR** - –Ω–µ—Ç –æ—à–∏–±–æ–∫ localStorage
- **–ü—Ä–æ—â–µ –∫–æ–¥** - –Ω–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –æ–±–µ—Ä—Ç–æ–∫ –∏ –ø—Ä–æ–≤–µ—Ä–æ–∫
- **–ë—ã—Å—Ç—Ä–µ–µ —Å–±–æ—Ä–∫–∞** - –º–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ** - —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç

### ‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è** –≤ localStorage
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## üîß –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **API** –≤–º–µ—Å—Ç–æ localStorage:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```typescript
// –ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å —Å–µ—Ä–≤–µ—Ä–∞
const { user, progress } = await fetch('/api/user/profile');
useUserStore.getState().setUser(user);

// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
await fetch('/api/user/progress', {
  method: 'POST',
  body: JSON.stringify(progress)
});
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π localStorage –≤ useEffect (–¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
```typescript
'use client';

import { useEffect } from 'react';
import { useUserStore } from '@/store/userStore';

export function useLocalStorageSync() {
  const store = useUserStore();
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  useEffect(() => {
    if (typeof window === 'undefined') return;
    
    const saved = localStorage.getItem('user-data');
    if (saved) {
      try {
        const data = JSON.parse(saved);
        store.setUser(data.user);
      } catch (e) {
        console.error('Failed to load from localStorage:', e);
      }
    }
  }, []);
  
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
  useEffect(() => {
    if (typeof window === 'undefined') return;
    if (!store.user) return;
    
    localStorage.setItem('user-data', JSON.stringify({
      user: store.user,
      userProgress: store.userProgress
    }));
  }, [store.user, store.userProgress]);
}
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–¢–µ–ø–µ—Ä—å —Å–±–æ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ:

```bash
npm run build
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úì Compiled successfully
‚úì Linting and checking validity of types
‚úì Collecting page data
‚úì Generating static pages (15/15)
‚úì Finalizing page optimization

NO localStorage ERRORS! ‚úÖ
```

## üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø—Ä–æ–≥—Ä–µ—Å—Å):
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API –∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### –î–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è):
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π localStorage —á–µ—Ä–µ–∑ useEffect
- ‚úÖ –û–±–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ –≤ –ø—Ä–æ–≤–µ—Ä–∫—É `typeof window !== 'undefined'`
- ‚úÖ –î–æ–±–∞–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è:
- ‚ùå –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏)
- ‚ùå –ë–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö (>5MB)
- ‚ùå –î–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

## üéì –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —É—Ä–æ–∫

**Zustand persist + Next.js SSR = –ü–ª–æ—Ö–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è**

–ü—Ä–∏—á–∏–Ω—ã:
1. localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. –£—Å–ª–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ –º–æ–¥—É–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
3. –°–ª–æ–∂–Ω—ã–µ –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏ –¥–µ–ª–∞—é—Ç –∫–æ–¥ —Ö—Ä—É–ø–∫–∏–º
4. –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ API –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ: –•—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ API.**

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞  
**–ú–µ—Ç–æ–¥:** –£–¥–∞–ª–µ–Ω–∏–µ persist middleware  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å SSR
